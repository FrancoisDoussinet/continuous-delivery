--- 
- name: Add vhost dir
  file: 
    path: /var/www/{{ domain_name }}/public_html
    owner: root
    group: root
    state: directory
    
- name: Define dir with rights
  file:
    path: /var/www
    mode: 0755
    state: directory
    
- name: Create home page
  template:
    src: files/index.html
    dest: /var/www/{{ domain_name }}/public_html/index.html

- name: Add available sites dir
  file: 
    path: /etc/httpd/sites-available
    owner: root
    group: root
    state: directory
   
- name: Add enabled sites dir
  file: 
    path: /etc/httpd/sites-enabled
    owner: root
    group: root
    state: directory
        
- name: Add sites-enabled into httpd conf
  lineinfile: 
    path: /etc/httpd/conf/httpd.conf
    insertafter: EOF
    line: 'IncludeOptional sites-enabled/*.conf'
  notify:
  - restart httpd

- name: Create virtual host
  template:
    src: files/vhost.conf
    dest: /etc/httpd/sites-available/{{ domain_name }}.conf
  notify:
  - restart httpd

- name: Activate virtual host
  file: 
    src: /etc/httpd/sites-available/{{ domain_name }}.conf 
    dest: /etc/httpd/sites-enabled/{{ domain_name }}.conf
    state: link
  notify:
  - restart httpd

